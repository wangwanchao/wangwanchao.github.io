---
title: 深入理解计算机系统--并发和并行
date: 2019-05-29 20:56:35
tags: CSAPP
categpries: CSAPP
---
看了一遍，感觉并没有解释的很深刻，也许是自己理解的问题。

<!-- more -->

## 并发
现代操作系统构建并发程序的方式：

1. 进程
	接收到请求后，fork一个子进程，由子进程来处理任务。因为每个进程的虚拟内存空间是独立的，所以进程间通信需要显式进行。常见的有：
	优点：共享文件表，不共享用户地址空间
	缺点：通信困难

	
2. I/O多路复用模型
	由select来监听接收请求，没有数据时CPU挂起，只有发生I/O事件时，才会处理。状态机模型，流之间的通信通过状态实现。例如：jdk的NIO模型、Netty的I/O模型
	
	改进：基于多路复用的事件驱动模型

	状态机模型：
		状态：等待描述符 $d_i$ 准备好可读，是否可读就是一种true/false的状态
		输入事件：描述符 $d_i$ 准备好可读，其实就是一个触发事件
		转移：从描述符 $d_i$ 读取数据，即状态转移，

	优点：处于同一进程内，所有的流可以共享该进程的全部地址空间
	缺点：编码复杂度上升
	
3. 线程
	多个线程在单一进程中，由内核统一调度，像进程一样，但是共享进程的虚拟内存空间。
	每个线程有自己的执行上下文，线程代码和局部数据被封装在一个线程例程中。每个独立的线程中的线程栈通常不能被其它线程访问，除非线程得到指向其他线程的访问指针。除此之外，线程中的全局变量、静态变量只存在进程的虚拟内存中，可以被其它线程访问

	Posix线程：在C程序中处理线程的一个标准接口
	
	可结合线程：线程能够被其它线程收回和杀死，内存也可以被其它线程回收。
	可分离线程：线程不能够被其它线程收回和杀死，内存由系统管理

## 信号量

共享变量存在线程安全的问题，可以使用一种进度图模型分析指令执行顺序问题。然后引入了信号量机制

### 进度图

进度图：n个并发线程的执行模型。进度图模型存在局限性，多处理器并发执行，不能使用进度图解释
临界区：

互斥

不安全区

安全轨迹
不安全轨迹

### 信号量

主要包含2个操作P(s)、V(s)，
P(s): 对s减1。如果s非0，则执行P线程s减1，否则P挂起，等待V唤醒
V(s): 对s加1。V可以重启P线程




