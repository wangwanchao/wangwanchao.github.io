---
title: 深入理解计算机系统--异常控制流
date: 2019-06-01 23:47:09
tags: CSAPP
categpries: CSAPP
---
异常

<!-- more -->

### 基本原理

异常控制流：现代系统通过使控制流发生突变来对这些情况做出反应，这些突变称为异常控制流。

异常：控制流中的突变。一部分由硬件实现，一部分由操作系统实现。

异常号：系统中可能的每种类型的异常都分配了一个唯一的非负整数，称为异常号。
> 其中一些异常号由CPU设计中分配。例如：被零除、缺页、内存访问违例、断点、算术运算溢出
> 其它号码由操作系统内核的设计者分配。例如：系统调用、来自外部I/O设备的信号

异常表：系统启动时，分配和初始化一张跳转表，称为异常表。表中维护了异常号-异常处理程序地址的关系。异常表的起始地址放在一个‘异常表基址寄存器’的特殊CPU寄存器内。


### 异常种类
| 类别 | 原因 | 异步/同步 | 返回行为 |
|-|:-:|:-:|:-:|
|中断| 来自I/O设备的信号 | 异步 | 总是返回到下一条指令 |
|陷阱| 有意的异常。      | 同步 | 总是返回到下一条指令 |
|故障| 潜在的可恢复的错误 | 同步 | 可能返回到当前指令   |
|终止| 不可恢复的错误    | 同步 | 不会返回            |

#### 故障指令
陷阱(系统调用)：普通程序运行在`用户模式`，系统调用运行在``内核模式`，系统为用户提供了特殊的`syscall n`指令，用户进行系统调用时进入陷阱模式。

故障：故障是由错误引起的，如果错误可以被修复，则将控制返回到引起故障的指令；如果不可修复，则返回到内核中的abort例程，abort例程会终止引起故障的应用程序。

终止：由不可恢复的致命错误引起，通常是一些硬件错误。

## 进程

### 逻辑控制流
并发流：并发流的思想与流运行的CPU核数、计算机数无关。

并行流：

### 私有地址空间
进程间内存空间私有

### 用户模式和内核模式
模式位：CPU通过设置某个寄存器的模式位，指定进程处于内核模式。











