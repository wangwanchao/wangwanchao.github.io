---
title: MySQL分库分表技术
date: 2018-09-17 17:24:13
tags: 分库分表
categories: MySQL
---
分库分表主要针对大流量用户网站，但是作为有追求的程序员，还是要熟悉理论，用的时候方便快速上手解决业务问题，毕竟生活主要还是Crud Boy

<!-- more --> 

分区：将存放数据的文件拆分成很多块儿，

分片：将数据分散存储在不同的服务器上

## 垂直拆分

### 垂直分表

在同一个数据库中，将表数据存储在表名不同、结构相同的表中

### 垂直分库


#### 问题

1. 跨库join问题
	
	拆库后数据可能分布在不同的实例、物理主机，基于安全，一般禁止跨库join、group by、order等操作。
	
	解决方案：
	
	1)、全局表：即字典表，所有可能关联表。将这些表在每个数据库保存一份，
	
	2)、字段冗余：不同的表保存一些关联表的字段，可能导致‘数据一致性’问题，因为要在不同的表维护相同的字段
	
	3)、 数据同步：
	
	4)、系统层组装：即通过代码组装处理数据，for循环可能导致循环RPC问题，循环查询数据库，连接费时。建议一次查询返回所有结果。

2. 跨库事务问题(分布式事务)
	
	

## 水平拆分

### 水平分表/横向分表

将表结构进行拆分，通过更细粒度的控制，将表分散在不同的服务器上，减少单表的压力

### 水平分库分表

1. 查询切分 将ID和库映射关系放在单独的主库中
2. 范围切分 按照时间区间/ID区间切分
3. Hash切分 取模切分


## 读写分离 ##


### 中间件 ###


开源：

MyCAT: 基于Cobar

Sharding-JDBC(sharding-shpere): 当当基于JDBC

Cobar: 阿里巴巴，一年不维护

DBPRoxy: 美团，基于360的Atlas，两年不维护

Oceanus: 50同城团队

Atlas: 360团队，不推荐

TDDL: 依赖Dimond，已死

MaxScale: MariaDB作者官方，不支持分库分表

MySQL Route: MySQL官方

商业：

OneProxy：平民软件

DRDS: 阿里巴巴，基于Cobar、MySQL-Proxy













