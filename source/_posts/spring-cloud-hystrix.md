---
title: 微服务--断路器(四)
date: 2019-01-17 21:20:00
tags: 
categpries: SpringCloud
---
服务之间的依赖，导致一个环节出问题，如果遇到高并发，就会导致资源耗尽，从而影响其它服务的调用，所以引入了断路器的概念。

<!-- more -->
## Hystrix ##
### 原理
1. 分为线程隔离、信号量隔离，线程隔离相对信号量隔离比较消耗资源。**默认**采用HystrixCommand线程隔离，
2. 微服务之间的调用包裹在HystrixCommand类中，这样每次都会启动一个新的线程执行
3. 熔断：**默认**超过50%的请求失败，将打开断路器，不再调用后端服务而直接失败，过一段时间后尝试一部分请求到后端，如果成功则关闭断路器
4. 超时时间：可以手动设置，当调用后端服务超过超时时间时，直接返回/执行fallback逻辑
5. 请求结果：成功、失败(异常、超时、拒绝、短路)

### 配置属性：
```
circuitBreaker:
	requestVolumeThreshold: 20   	#滑动窗口大小，默认20次
	sleepWindowInMilliseconds: 5000  #过多久断路器再次检测是否开启
	errorThresholdPercentage: 50  	#错误率

```

### 应用场景：

1. 隔离（线程隔离、信号量隔离）：主要是限制调用分布式服务的资源，避免个别服务出现问题时对其他服务产生影响
2. 熔断（容错）：当失败率达到一定阈值时，熔断器触发快速失败
3. 降级（超时降级、熔断降级）：触发降级时可以使用回调方法返回托底数据
4. 缓存：请求缓存、请求合并
5. 实时监控、报警

### 线程池和信号量的区别
线程池：

信号量：
## Sentinel(阿里) ##
### 原理


特性：

1. 轻量级、高性能： sentinel-core不到200KB，单机超过25W QPS才会有影响
2. 流量控制：以不同的运行指标为基准，
	> 直接拒绝模式
	> 慢启动预热模式
	> 匀速度模式
3. 系统负载保护

### 应用场景：

1. 和Dubbo整合，通过限流实现服务的高可用
2. 和RocketMQ整合，通过匀速请求和冷启动保障服务的稳定性

### Hystrix和Sentinel的对比 ###
